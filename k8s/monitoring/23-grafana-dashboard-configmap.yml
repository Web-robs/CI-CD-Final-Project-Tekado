apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
  namespace: monitoring
data:
  dashboards.yaml: |
    apiVersion: 1
    providers:
      - name: "tekado"
        orgId: 1
        folder: ""
        type: file
        disableDeletion: true
        editable: true
        options:
          path: /var/lib/grafana/dashboards
  tekado-backend.json: |
    {
      "id": null,
      "title": "Tekado Backend (prom-client)",
      "timezone": "browser",
      "schemaVersion": 38,
      "version": 1,
      "refresh": "10s",
      "panels": [
        {
          "type": "timeseries",
          "title": "Process RSS Memory (bytes)",
          "gridPos": { "x": 0, "y": 0, "w": 12, "h": 8 },
          "targets": [
            { "expr": "process_resident_memory_bytes", "legendFormat": "rss" }
          ]
        },
        {
          "type": "timeseries",
          "title": "Process CPU (seconds total)",
          "gridPos": { "x": 12, "y": 0, "w": 12, "h": 8 },
          "targets": [
            { "expr": "rate(process_cpu_user_seconds_total[1m]) + rate(process_cpu_system_seconds_total[1m])", "legendFormat": "cpu_s" }
          ]
        },
        {
          "type": "timeseries",
          "title": "HTTP Requests (by route/status)",
          "gridPos": { "x": 0, "y": 8, "w": 24, "h": 8 },
          "targets": [
            { "expr": "sum by (route, status) (rate(http_requests_total[1m]))", "legendFormat": "{{route}} {{status}}" }
          ]
        }
      ]
    }

